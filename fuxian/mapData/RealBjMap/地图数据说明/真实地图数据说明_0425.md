# 真实地图数据说明_0425_FromMSJ

## 1 区域示意图

![wx4e](./wx4e%E7%A4%BA%E6%84%8F%E5%9B%BE.png)

wx4e 一共分了32个区域，此次选择的是北理工周边 ：wx4eq、wx4er、wx4en、wx4ep 四个小区域的道路数据。

![大范围地图示意](./%E5%A4%A7%E5%9C%B0%E5%9B%BE%E8%8C%83%E5%9B%B4.png)

![四个区域示意](./%E5%9B%9B%E4%B8%AA%E5%8C%BA%E5%9F%9F%E8%8C%83%E5%9B%B4.png)

## 2 文件架构 and 数据范围

文件中一共存在5份地图，结构树如下:

```shell
mmm@myLinux:~/mapData/realmap/RealBJMap$ tree
.
├── out_wx4e.json
├── out_wx4en.json
├── out_wx4ep.json
├── out_wx4eq.json
└── out_wx4er.json

0 directories, 5 files
```

不同的地图平台，使用的坐标系不同，因此，同一条路在不同地图平台中对应的经纬度也存在不同的可能性。

坐标系与地图平台的具体对应情况：
类型  | 说明 | 使用者  
:-:|:-: |:-:
WGS84    |     美国GPS      |   国际通用，如谷歌国外地图、osm地图
火星系GCJ-02    |     国测局制定的标准，国内地图必须至少使用此对位置进行首次加密      |   高德地图、腾讯搜搜地图、阿里云地图、谷歌中国地图
BD-09    |     百度在GCJ-02标准基础上进行二次加密      |   百度地图

由于我是从`OpenStreetMap`上获取到的`shapefile`地图数据，由对应表可知，该数据与国内的地图数据采用的坐标系不同，因此，我按照`WGS84坐标系`选取各区域范围的经纬度，范围如下。

1. **out_wx4eq.json** 的数据范围为：
    * 经度：[116.279,116.323]
    * 纬度：[39.947,39.991]
2. **out_wx4er.json** 的数据范围为：
    * 经度：[116.323,116.367]
    * 纬度：[39.947,39.991]
3. **out_wx4en.json** 的数据范围为：
    * 经度：[116.279,116.323]
    * 纬度：[39.903,39.947]
4. **out_wx4ep.json** 的数据范围为：
    * 经度：[116.323,116.367]
    * 纬度：[39.903,39.947]
5. **out_wx4e.json** 是上述四个数据的总和，数据范围为：
    * 经度：[116.279,116.367]
    * 纬度：[39.903,39.991]

## 3 数据可信度

摘取一条数据进行观察：

```json
// 转换前
{"properties":{"minzoom":7,"highway":"tertiary","cost":275,"gid":77922,"name":"北蜂窝路","source":14360,"target":13987,"oneway":"yes"},"geometry":{"type":"LineString","coordinates":[[116.3227718,39.9037387],[116.3227968,39.9012597]]},"type":"Feature"}
// 转换后
{"properties":{"minzoom":7,"highway":"tertiary","cost":275,"gid":77922,"name":"北蜂窝路","source":14360,"target":13987,"oneway":"yes"},"geometry":{"coordinates":["wx4enbr8jh1","wx4dyzz9ttg"],"type":"LineString"},"type":"Feature"}
```

可以看到，一条道路信息中会对应好几个geohash编码。这说明该道路是由这些geohash表示的经纬度信息首尾相连。

设获取到的地图数据为 `out_x.json`，则通过分析该json文件中，geohash 编码的前缀是否与 x 相同，可以获知：`实际地图数据与编码区域命名`的相符程度。即：

* **数据正确**：如果该文件中的 geohash 编码绝大部分与 x 相同，说明对应的道路数据落点都在 `区域x` 内，即说明该区域数据正确，编码与地图区域相符。
* **数据有误**：如果该文件中的 geohash 编码绝大部分与 x 不同，说明对应的道路数据落点大多不在 `区域x` 内，即说明选取的区域经纬度范围不正确，数据有误，编码与地图区域不符。

按照此思路，对已有的5份地图数据进行分析。

### 3.1 out_wx4e.json数据分析

* wx4前缀：11024
  * wx4e前缀：11004
    * wx4eq、wx4er、wx4en、wx4ep前缀总和：10908

* wx4eq、wx4er、wx4en、wx4ep**总和占比：98.95%**

### 3.2 out_wx4eq.json数据分析

* wx4前缀：2996
  * wx4e前缀：2996
    * wx4eq前缀：2935

* wx4eq**占比：97.96%**

### 3.3 out_wx4er.json数据分析

* wx4前缀：2441
  * wx4e前缀：2430
    * wx4er前缀：2396

* wx4er**占比：98.16%**

### 3.4 out_wx4en.json数据分析

* wx4前缀：2009
  * wx4e前缀：2006
    * wx4en前缀：1931

* wx4en**占比：96.12%**

### 3.5 out_wx4ep.json数据分析

* wx4前缀：3578
  * wx4e前缀：3572
    * wx4ep前缀：3495

* wx4ep**占比：97.84%**

每个地图文件中，geohash 编码的5位前缀都与当前区域的编码极大程度上一致，因此认为地图数据基本正确。

## 4 上传效果

以`out_wx4e.json`地图数据为例，进行测试。

将该地图数据上传至区块链后，运行出租车调度系统，可以看到地图显示效果如下：

![显示正常](./2023-04-25%20(6).png)

有正确的显示。

根据选定的一组车乘点位进行运行，运行效果如下：

![运行成功](./2023-04-26%20(1).png)

观察到PickUp()和manageToEnd()过程正常，且乘客可以完成整个打车流程，车辆最终变成空车，认为整个系统运行成功。
